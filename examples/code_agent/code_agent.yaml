variables:
  max_tokens: 64000

type: agent
name: nexau_code_agent
max_context_tokens: ${variables.max_tokens}
system_prompt: ./system-workflow.md
system_prompt_type: jinja
tool_call_mode: openai # xml, openai or anthropic
llm_config: # Support environment variable replacement in YAML config
  model: ${env.LLM_MODEL}
  base_url: ${env.LLM_BASE_URL}
  api_key: ${env.LLM_API_KEY}
  stream: true
  max_tokens: ${variables.max_tokens}
  api_type: openai_chat_completion # support openai_chat_completion (default), openai_responses (especially for gpt-5-codex), anthropic_chat_completion
tools: # Tool definition and implementation (binding) are decoupled
  - name: web_search
    yaml_path: ./tools/WebSearch.tool.yaml
    binding: nexau.archs.tool.builtin.web_tool:web_search
  - name: web_read
    yaml_path: ./tools/WebFetch.tool.yaml
    binding: nexau.archs.tool.builtin.web_tool:web_read
  - name: todo_write
    yaml_path: ./tools/TodoWrite.tool.yaml
    binding: nexau.archs.tool.builtin.todo_write:todo_write
  - name: grep
    yaml_path: ./tools/Grep.tool.yaml
    binding: nexau.archs.tool.builtin.file_tools.grep_tool:grep_tool
  - name: glob
    yaml_path: ./tools/Glob.tool.yaml
    binding: nexau.archs.tool.builtin.file_tools.glob_tool:glob_tool
  - name: file_read
    yaml_path: ./tools/Read.tool.yaml
    binding: nexau.archs.tool.builtin.file_tools.file_read_tool:file_read_tool
  - name: file_write
    yaml_path: ./tools/Write.tool.yaml
    binding: nexau.archs.tool.builtin.file_tools.file_write_tool:file_write_tool
  - name: file_edit
    yaml_path: ./tools/Edit.tool.yaml
    binding: nexau.archs.tool.builtin.file_tools.file_edit_tool:file_edit_tool
  - name: bash
    yaml_path: ./tools/Bash.tool.yaml
    binding: nexau.archs.tool.builtin.bash_tool:bash_tool
  - name: ls
    yaml_path: ./tools/Ls.tool.yaml
    binding: nexau.archs.tool.builtin.ls_tool:ls_tool
  - name: multiedit
    yaml_path: ./tools/MultiEdit.tool.yaml
    binding: nexau.archs.tool.builtin.multiedit_tool:multiedit_tool
  - name: run_code
    yaml_path: ./tools/RunCode.tool.yaml
    binding: nexau.archs.tool.builtin.run_code_tool:run_code_tool
skills: # Skills are used to hint the agent to solve specific tasks
  - ./skills/template-skill
  - ./skills/theme-factory
middlewares: # Middlewares are used to modify the behavior of the agent.
  - import: nexau.archs.main_sub.execution.middleware.context_compaction:ContextCompactionMiddleware
    params:
      max_context_tokens: ${variables.max_tokens}
      auto_compact: true
      threshold: 0.75  # Trigger compaction when token usage reaches 75%
      compaction_strategy: "tool_result_compaction"  # "sliding_window" or "tool_result_compaction"
      window_size: 2  # Only use in sliding_window strategy, keep last 2 conversation rounds

      # Only use in sliding_window strategy, Summary model for compression
      summary_model: ${env.SUMMARY_MODEL}
      summary_base_url: ${env.SUMMARY_BASE_URL}
      summary_api_key: ${env.SUMMARY_API_KEY}

  - import: nexau.archs.main_sub.execution.hooks:LoggingMiddleware
    params:
      model_logger: "nexau_code_agent"
      tool_logger: "nexau_code_agent"
      log_model_calls: true
tracers:
  - import: nexau.archs.tracer.adapters.langfuse:LangfuseTracer
    params:
      public_key: ${env.LANGFUSE_PUBLIC_KEY}
      secret_key: ${env.LANGFUSE_SECRET_KEY}
      host: ${env.LANGFUSE_HOST}
